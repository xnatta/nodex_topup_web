(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1551:(e,t,s)=>{Promise.resolve().then(s.bind(s,3792))},3792:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(5155),r=s(2115),l=s(6766),o=s(5695);function c(){let[e,t]=(0,r.useState)(null),[s,c]=(0,r.useState)(!0),[n,i]=(0,r.useState)([]),[d,x]=(0,r.useState)(!0),[u,h]=(0,r.useState)(null),[g,p]=(0,r.useState)(["ทั้งหมด"]),[m,f]=(0,r.useState)(!0),[j,y]=(0,r.useState)(null),[b,w]=(0,r.useState)(!1),[N,v]=(0,r.useState)("ทั้งหมด"),k=(0,r.useRef)(null),E=(0,o.useRouter)(),S="https://discord.com/api/oauth2/authorize?client_id=".concat("1392191513295061224","&redirect_uri=").concat("http://localhost:3000/api/callback","&response_type=code&scope=identify%20guilds%20guilds.members.read");(0,r.useEffect)(()=>{console.log("page.tsx: fetchUserData started."),async function(){try{let e=await fetch("/api/user");if(console.log("page.tsx: /api/user response.ok:",e.ok),e.ok){let s=await e.json();console.log("page.tsx: User data fetched successfully:",s),t(s)}else console.log("page.tsx: /api/user response not OK. Setting user to null."),t(null)}catch(e){console.error("page.tsx: Failed to fetch user data:",e),t(null)}finally{c(!1),console.log("page.tsx: fetchUserData finished. loadingUser set to false.")}}();let e=e=>{k.current&&!k.current.contains(e.target)&&w(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[E]),(0,r.useEffect)(()=>{!async function(){try{x(!0),h(null);let e=await fetch("/api/products");if(e.ok){let t=await e.json();i(t)}else{let t=await e.text();throw Error("Failed to fetch products: ".concat(t))}}catch(e){console.error("Error fetching products:",e),h(e.message)}finally{x(!1)}}()},[]),(0,r.useEffect)(()=>{!async function(){try{f(!0),y(null);let e=await fetch("/api/categories");if(e.ok){let t=await e.json();p(["ทั้งหมด",...t])}else{let t=await e.text();throw Error("Failed to fetch categories: ".concat(t))}}catch(e){console.error("Error fetching categories:",e),y(e.message)}finally{f(!1)}}()},[]);let _="ทั้งหมด"===N?n:n.filter(e=>e.category===N),L=async()=>{try{let e=await fetch("/api/logout",{method:"POST"});e.ok?(t(null),w(!1)):(console.error("Logout failed:",await e.text()),alert("เกิดข้อผิดพลาดในการ Logout"))}catch(e){console.error("Error during logout:",e),alert("เกิดข้อผิดพลาดในการ Logout")}};return(0,a.jsxs)("main",{className:"min-h-screen bg-gray-900 text-white p-6",children:[(0,a.jsx)("header",{className:"p-4 bg-gray-800 rounded-lg shadow-md mb-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[(0,a.jsx)(l.default,{src:"/NODEX_LOGO.ico",alt:"Website Logo",width:40,height:40,className:"rounded-full"}),(0,a.jsx)("div",{className:"text-3xl font-extrabold text-purple-400",children:"NodeX Shop"})]}),(0,a.jsx)("nav",{className:"flex justify-center flex-grow mx-4",children:(0,a.jsx)("div",{className:"bg-gray-700 p-3 rounded-lg shadow-md flex flex-wrap gap-3",children:m?(0,a.jsx)("p",{className:"text-gray-400",children:"กำลังโหลดหมวดหมู่..."}):j?(0,a.jsxs)("p",{className:"text-red-400",children:["เกิดข้อผิดพลาด: ",j]}):g.map(e=>(0,a.jsx)("button",{onClick:()=>v(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors\n                      ".concat(N===e?"bg-purple-600 text-white shadow-inner":"bg-gray-600 text-gray-300 hover:bg-gray-500"),children:e},e))})}),(0,a.jsx)("div",{className:"relative flex-shrink-0",ref:k,children:s?(0,a.jsx)("div",{className:"px-6 py-3 rounded-lg bg-gray-700 text-gray-400",children:"กำลังโหลด..."}):e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 bg-gray-700 p-3 rounded-lg shadow-md cursor-pointer hover:bg-gray-600 transition-colors",onClick:()=>w(!b),children:[e.avatar?(0,a.jsx)(l.default,{src:"https://cdn.discordapp.com/avatars/".concat(e.id,"/").concat(e.avatar,".png?size=128"),alt:"".concat(e.username,"'s avatar"),width:40,height:40,className:"rounded-full border-2 border-purple-500"}):(0,a.jsx)("div",{className:"w-10 h-10 flex items-center justify-center bg-gray-600 rounded-full text-sm font-bold",children:e.username.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-semibold text-base",children:[e.username,"#",e.discriminator]}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"เข้าสู่ระบบด้วย Discord"}),(0,a.jsxs)("p",{className:"text-sm text-yellow-300 font-bold",children:["Points: ",e.points]})]})]}),b&&(0,a.jsx)("div",{className:"absolute right-0 mt-2 w-48 bg-gray-700 rounded-md shadow-lg py-1 z-10",children:(0,a.jsx)("button",{onClick:L,className:"block w-full text-left px-4 py-2 text-sm text-red-300 hover:bg-gray-600 hover:text-red-200 rounded-md transition-colors",children:"ออกจากระบบ (Logout)"})})]}):(0,a.jsx)("a",{href:S,children:(0,a.jsx)("button",{className:"bg-purple-600 text-white px-6 py-3 rounded-lg shadow hover:bg-purple-700 transition-colors",children:"Login with Discord"})})})]})}),(0,a.jsxs)("section",{className:"flex flex-col items-center",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-8 text-purple-400",children:"สินค้าของเรา"}),d?(0,a.jsx)("p",{className:"text-gray-400 text-lg",children:"กำลังโหลดสินค้า..."}):u?(0,a.jsxs)("p",{className:"text-red-500 text-lg",children:["เกิดข้อผิดพลาดในการโหลดสินค้า: ",u]}):_.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 w-full max-w-7xl",children:_.map(e=>(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-transform hover:scale-105",children:[(0,a.jsx)(l.default,{src:e.imageUrl,alt:e.name,width:300,height:200,className:"w-full h-48"}),(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-2 text-purple-300",children:e.name}),(0,a.jsx)("p",{className:"text-gray-300 mb-4 text-sm",children:e.description}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-2xl font-extrabold text-green-400",children:[e.price.toFixed(2)," THB"]}),(0,a.jsx)("button",{className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:"ซื้อเลย"})]})]})]},e.id))}):(0,a.jsx)("p",{className:"col-span-full text-center text-gray-400 text-lg",children:"ไม่พบสินค้าในหมวดหมู่นี้"})]}),(0,a.jsx)("footer",{className:"text-center text-gray-500 mt-12 p-4",children:(0,a.jsxs)("p",{children:["\xa9 ",new Date().getFullYear()," My Shop. All rights reserved."]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[212,441,684,358],()=>t(1551)),_N_E=e.O()}]);